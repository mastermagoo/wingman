#!/bin/sh
# Repo-local pre-commit hook: block secrets and cross-project contamination

# Check 1: Only wingman/ files should be staged
STAGED=$(git diff --cached --name-only)
if [ -n "$STAGED" ]; then
    NON_WINGMAN=$(echo "$STAGED" | grep -v "^wingman/" | grep -v "^\.gitignore$" | grep -v "^\.githooks/" | grep -v "^\.github/")
    if [ -n "$NON_WINGMAN" ]; then
        echo "‚ùå BLOCKED: Files outside wingman/ are staged!"
        echo ""
        echo "Staged files outside wingman/:"
        echo "$NON_WINGMAN"
        echo ""
        echo "This repository should only contain wingman/ subdirectory changes."
        echo "Run: cd wingman && git add . (work from wingman subdirectory)"
        exit 1
    fi
fi

# Check 2: Secret scanning
python3 tools/secret_scan.py
exit $?
